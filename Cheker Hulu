from telegram.ext import Updater, CommandHandler, MessageHandler, Filters

def luhn_checksum(card_number):
    def digits_of(n):
        return [int(d) for d in str(n)]
    digits = digits_of(card_number)
    odd_digits = digits[-1::-2]
    even_digits = digits[-2::-2]
    checksum = sum(odd_digits)
    for d in even_digits:
        checksum += sum(digits_of(d*2))
    return checksum % 10

def is_valid(card_number):
    return luhn_checksum(card_number) == 0

def start(update, context):
    update.message.reply_text('Envía el número de tarjeta para validar.')

def check_card(update, context):
    card_number = update.message.text.replace(" ", "")
    if card_number.isdigit() and 13 <= len(card_number) <= 19:
        if is_valid(card_number):
            update.message.reply_text("✅ Tarjeta válida (formato correcto).")
        else:
            update.message.reply_text("❌ Tarjeta inválida.")
    else:
        update.message.reply_text("Por favor, envía un número de tarjeta válido.")

def main():
    TOKEN = "TU_API_TOKEN_AQUI"
    updater = Updater(TOKEN, use_context=True)
    dp = updater.dispatcher
    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, check_card))
    updater.start_polling()
    updater.idle()

if __name__ == '__main__':
    main()